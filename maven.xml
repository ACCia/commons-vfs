<project default="jar:jar" xmlns:j="jelly:core">

    <!-- we can customize the Maven build here -->

    <!-- Set up the test files -->
    <postGoal name="test:test-resources">

        <copy todir="${test.basedir}/read-tests">
            <fileset dir="${test.data.src}/basedir"/>
        </copy>
        <copy todir="${test.basedir}/">
            <fileset dir="${test.data.src}" includes="nested.*,test.*"/>
        </copy>


        <!-- Compile the code for the class loader test -->
        <javac
            destdir="${test.basedir}"
            debug="${maven.compile.debug}"
            deprecation="${maven.compile.deprecation}"
            optimize="${maven.compile.optimize}">
            <src>
                <path>
                    <pathelement location="${test.data.src}"/>
                </path>
            </src>
        </javac>

        <mkdir dir="${test.basedir}/read-tests/emptydir"/>

        <!-- Create a zip file - its not possible to create tgz, tar and tbz2 so we provide
				the whole set for download now
        <zip zipfile="${test.basedir}/test.zip">
            <zipfileset dir="${test.basedir}">
                <include name="read-tests/**"/>
                <include name="code/**"/>
            </zipfileset>
        </zip>
        <zip zipfile="${test.basedir}/nested.zip">
            <zipfileset dir="${test.basedir}">
                <include name="test.zip"/>
            </zipfileset>
        </zip>

        <jar
            jarfile="${test.basedir}/test.jar"
            manifest="${test.data.src}/test.mf">
            <fileset dir="${test.basedir}">
                <include name="read-tests/**"/>
                <include name="code/**"/>
            </fileset>
        </jar>

        <jar
            jarfile="${test.basedir}/nested.jar"
            basedir="${test.basedir}"
            includes="test.jar"/>
        -->
    </postGoal>

    <postGoal
      name="dist:prepare-bin-filesystem">
      <j:set
        var="maven.dist.bin.assembly.dir"
        value="${pom.getPluginContext('maven-dist-plugin').getVariable('maven.dist.bin.assembly.dir')}" />

      <copy file="${basedir}/NOTICE.txt"
            tofile="${maven.dist.bin.assembly.dir}/NOTICE.txt"
            overwrite="yes"/>
        <copy file="${basedir}/RELEASE_NOTES.txt"
              tofile="${maven.dist.bin.assembly.dir}/RELEASE_NOTES.txt"
              overwrite="yes"/>

    </postGoal>

    <postGoal
      name="dist:prepare-src-filesystem">
      <j:set
        var="maven.dist.src.assembly.dir"
        value="${pom.getPluginContext('maven-dist-plugin').getVariable('maven.dist.src.assembly.dir')}" />

      <copy file="${basedir}/NOTICE.txt"
            tofile="${maven.dist.src.assembly.dir}/NOTICE.txt"
            overwrite="yes"/>
        <copy file="${basedir}/RELEASE_NOTES.txt"
              tofile="${maven.dist.src.assembly.dir}/RELEASE_NOTES.txt"
              overwrite="yes"/>

    </postGoal>

</project>
