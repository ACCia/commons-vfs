<project default="java:jar" xmlns:j="jelly:core">

  <!-- we can customize the Maven build here -->

  <!-- Set up the test files -->
  <postGoal name="test:test-resources">

    <copy todir="${test.basedir}">
      <fileset dir="${test.data.src}">
        <include name="basedir/**"/>
      </fileset>
    </copy>
    
    <!-- Compile the code for the class loader test -->
    <javac
      destdir="${test.basedir}/basedir"
      debug="${maven.compile.debug}"
      deprecation="${maven.compile.deprecation}"
      optimize="${maven.compile.optimize}">
      <src>
        <path>
          <pathelement location="${test.data.src}"/>
        </path>
      </src>
    </javac>

    <mkdir dir="${test.basedir}/basedir/emptydir"/>

    <!-- Create a zip file -->
    <zip zipfile="${test.basedir}/test.zip">
      <zipfileset dir="${test.basedir}">
        <include name="basedir/**"/>
      </zipfileset>
    </zip>
    <zip zipfile="${test.basedir}/nested.zip">
      <zipfileset dir="${test.basedir}">
        <include name="test.zip"/>
      </zipfileset>
    </zip>
    
    <jar
      jarfile="${test.basedir}/test.jar"
      basedir="${test.basedir}"
      includes="basedir/**"
      manifest="${test.data.src}/test.mf"/>

    <jar
      jarfile="${test.basedir}/normal.jar"
      basedir="${test.basedir}/basedir"
      manifest="${test.data.src}/normal.mf"/>
    <jar
      jarfile="${test.basedir}/nested.jar"
      basedir="${test.basedir}"
      includes="test.jar,normal.jar"/>
  </postGoal>
    
</project>
